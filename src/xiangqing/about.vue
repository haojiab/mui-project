<template>
    <div>
        <header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<div class="mui-content">
                <div style="padding: 10px 10px;">
                    <div id="segmentedControl" class="mui-segmented-control">
                        <a class="mui-control-item mui-active" href="#item1">å•†å“</a>
                        <a class="mui-control-item" href="#item2">è¯„ä»·</a>
                        <a class="mui-control-item" href="#item3">è¯¦æƒ…</a>
                        <a class="mui-control-item" href="#item4">æ¨è</a>
                    </div>
                </div>
			</div>
		</header>
        <div>
                    <div id="item1" class="mui-control-content mui-active">
                       <div class="mui-card about-in">
				            <div class="mui-card-header">
                                <img v-bind:src="img_url" alt="">
                                <transition
                                        @before-enter="beforeEnter"
                                        @enter="enter"
                                        @after-enter="afterEnter"
                                        
                                    >
                                    <img class="ball" ref="img" v-if="flag"  v-bind:src="img_url" alt="">
                                </transition>
                                
                            </div>
				                <div class="mui-card-content">
					                <div class="mui-card-content-inner">
                                        {{title}}
                                        {{zhaiyao}}
                                        <div class="price">
                                            <span>ï¿¥{{market_price}}</span>
                                            <span>ï¿¥{{sell_price}}</span>
                                        </div>
					                </div>
				                </div>
				            <div class="mui-card-footer">
                                <div class="xiang">
                                    <p>
                                        å·²é€‰
                                        <span>1ä¸ª</span>
                                        <a href="#picture" class="righ mui-btn-outlined">Â·Â·Â·</a>
                                         
                                    </p>
                                    <p>
                                        é€è‡³
                                        <span>å±±è¥¿çœä¸´æ±¾å¸‚å°§éƒ½åŒº</span>
                                        <span class="righ">Â·Â·Â·</span>
                                    </p>
                                    <p>
                                        è¿è´¹
                                        <span>å…è¿è´¹</span>
                                        <span class="righ">Â·Â·Â·</span>
                                    </p>
                                </div>
                                <div id="picture" class="mui-popover mui-popover-action mui-popover-bottom">
                                    <ul class="mui-table-view">
                                        <li class="mui-table-view-cell">
                                             <div class="mui-numbox"  data-numbox-min='1' data-numbox-max='999'>
					<button class="mui-btn mui-btn-numbox-minus" type="button">-</button>
					<input id="test" class="mui-input-numbox" type="number" value="1" />
					<button class="mui-btn mui-btn-numbox-plus" type="button">+</button>
				</div>
                                        </li>
                                    </ul>
                                    <ul class="mui-table-view">
                                        <li class="mui-table-view-cell">
                                            <a href="#picture"><b>å–æ¶ˆ</b></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
			            </div>
                    </div>
                    <div id="item2" class="mui-control-content">
                        <div class="mui-card">
				            <div class="mui-card-header">
                                D****c 
                                <span class="star">â˜†â˜†â˜†â˜†â˜†</span>
                            </div>
				                <div class="mui-card-content">
					                <div class="mui-card-content-inner">
                                        è¿™æ¬¡æ¢ä¸ªåœ°æ–¹ï¼Œç‰©æµæŒºå¿«çš„ï¼Œéš”å¤©å°±åˆ°äº†ï¼Œè¿™ä¸ªå…¨éº¦å¹²é…ªæ¬§åŒ…è¦è‡ªå·±å»åˆ‡å¼€çš„ï¼Œå‘³é“è¿˜æŒºä¸é”™çš„ï¼
					                </div>
				                </div>
				            <div class="mui-card-footer">
                                <img src="../image/f1.jpg" alt="">
                                <img src="../image/f1.jpg" alt="">
                                <img src="../image/f1.jpg" alt="">
                            </div>
			            </div>
                        <div class="mui-card">
				            <div class="mui-card-header">
                                ä¸****åˆ° 
                                <span class="star">â˜†â˜†â˜†â˜†â˜†</span>
                            </div>
				                <div class="mui-card-content">
					                <div class="mui-card-content-inner">
                                        é¦–å…ˆé¡ºä¸°çœŸçš„å¾ˆç»™åŠ›ï¼Œéš”å¤©å°±åˆ°äº†ï¼Œæ‹¿åˆ°æ‰‹æ—¶é¡¿æ—¶æ„Ÿå—åˆ°ç›’å­çš„å‡‰æ„ï½ä¿é²œåšçš„æå¥½å‘€ï½å–å®¶å¾ˆè´´å¿ƒçš„é€äº†å°ç¤¼ç‰©ï¼Œæœ¬å­ä¸Šçš„å­—ä¹Ÿæ˜¯æ£’æ£’çš„ï¼ŒåŒ…è£…ç‰¹åˆ«å¥½ç‰¹åˆ«å«ç”Ÿï¼Œç„¶åæˆ‘è¿«ä¸åŠå¾…çš„æ›¿å¤§å®¶å°äº†ä¸€å£ï¼Œæ— ç³–ï¼Œä½†æ˜¯ç‰¹åˆ«ç¾å‘³ï¼Œæ»¡æ»¡çš„å¹¸ç¦æ„Ÿï½æ€»ä¹‹è¶…çº§å¤§çš„å¥½è¯„ä¸€å®šä¼šå›è´­ï¼Œæ‰“ç®—å°å°æŠ¹èŒ¶ç´«è–¯ï¼Œæ®è¯´ä¹Ÿå¾ˆä¸é”™ğŸ‘
					                </div>
				                </div>
				            <div class="mui-card-footer">
                                <img src="../image/f2.jpg" alt="">
                                <img src="../image/f2.jpg" alt="">
                                <img src="../image/f2.jpg" alt="">
                            </div>
			            </div>
				    </div>
				    <div id="item3" class="mui-control-content">
                        <img class="xi" src="../image/x1.jpg" alt="">
				    </div>
                    <div id="item4" class="mui-control-content">
                        <ul class="mui-table-view mui-grid-view">
		        <li class="mui-table-view-cell mui-media mui-col-xs-6">
		            <router-link to="/home/supermarket/about" href="#">
		                <img class="mui-media-object" src="../image/f1.jpg">
		                <div class="mui-media-body">ï¿¥39.9</div></router-link></li>
		        <li class="mui-table-view-cell mui-media mui-col-xs-6">
		            <a href="#">
		                <img class="mui-media-object" src="../image/f2.jpg">
		                <div class="mui-media-body">ï¿¥59.9</div></a></li>
		        <li class="mui-table-view-cell mui-media mui-col-xs-6">
		            <a href="#"><img class="mui-media-object" src="../image/f3.jpg">
		                <div class="mui-media-body">ï¿¥38.8</div></a></li>
		        <li class="mui-table-view-cell mui-media mui-col-xs-6">
		            <a href="#">
		                <img class="mui-media-object" src="../image/f4.jpg">
		                <div class="mui-media-body">ï¿¥29.9</div></a></li>
		    </ul>    
				    </div>
                </div>
            <!-- åº•éƒ¨ -->
            <nav class="mui-bar mui-bar-tab buy">
		            <a class="mui-col-xs-2" href="#">
		                    <span class="mui-icon mui-icon-chatbubble"></span>
		                    <div class="mui-media-body">è”ç³»å®¢æœ</div></a>
		            <a class="mui-col-xs-2" href="#">
		                   <span class="mui-icon mui-icon-upload"></span>
		                    <div class="mui-media-body">è¿›åº—</div></a>
		            <router-link to="/char" class="mui-col-xs-2" id="gouwu" href="#">
		                    <span class="mui-icon-extra mui-icon-extra-cart"></span>
                            <span class="mui-badge items">{{$store.getters.getnum}}</span></span>
		                    <div class="mui-media-body">è´­ç‰©è½¦</div></router-link>
                    <a @click="flag=!flag;addItems()"   href="#" class="mui-col-xs-3">
                        åŠ å…¥è´­ç‰©è½¦
                    </a>
                    <a href="#" class="mui-col-xs-3">
                        ç«‹å³è´­ä¹°
                    </a>
		    </nav>
    </div>
</template>

<script>
import swiper from '../swiper/swiper.vue';
import mui from '../js/mui.js'
mui(".mui-numbox").numbox
export default {
    data(){
        return {
            id:this.$route.params.id,
            title:this.$route.params.title,
            zhaiyao:this.$route.params.zhaiyao,
            market_price:this.$route.params.market_price,
            sell_price:this.$route.params.sell_price,
            img_url:this.$route.params.img_url,
            swipList:[],
            flag: false,
            goodInfo:{},
            goodsNumber:1
        }
    },
    methods:{
        getGoodsInfo(){
            this.$http.get('api/goods/getinfo/'+this.id).then(result=>{
                if(result.body.status===0){
                    this.goosInfo = result.body;
                    //console.log(this.goodInfo)
                }else{
                    alert("è¯·æ±‚å¤±è´¥")
                }
            })
        },
        getGoodsNumber(count){
            this.goodsNumber = count
        },
        getGoodImage(){
            this.$http.get('api/getthumimages/'+this.id).then(result=>{
                if(result.body.status===0){
                    for (var i in result.body.message) {
                        this.swipList[i]={img:result.body.message[i].src}
                    }
                     console.log(this.swipList)
                }else{
                    console.log('å¤±è´¥')
                }
            })
        },
        beforeEnter(el) {
                    // è¡¨ç¤ºåŠ¨ç”»å…¥åœºä¹‹å‰ï¼Œæ­¤æ—¶åŠ¨ç”»è¿˜æœªå¼€å§‹ï¼Œå¯ä»¥åœ¨å…¶ä¸­
                    // è®¾ç½®å…ƒç´ å¼€å§‹åŠ¨ç”»ä¹‹å‰çš„èµ·å§‹æ ·å¼
                    // è®¾ç½®å°çƒå¼€å§‹åŠ¨ç”»ä¹‹å‰çš„èµ·å§‹ä½ç½®
                    el.style.transform = 'translate(0,0)';
                },
        enter(el,done) {
                    //æ²¡æœ‰å®é™…æ•ˆæœï¼Œä½†ä¸å¯ç¼ºå°‘ï¼Œå¯ä»¥ç†è§£ä¸ºå¼ºåˆ¶åŠ¨ç”»åˆ·æ–°
                    el.offsetWidth;//offsetHeightã€offsetLeftç­‰éƒ½å¯ä»¥
                    //è¡¨ç¤ºåŠ¨ç”»ï¼Œå¼€å§‹ä¹‹åçš„æ ·å¼ï¼Œå¯ä»¥è®¾ç½®å°çƒå®ŒæˆåŠ¨ç”»çš„ç»“æŸçŠ¶æ€
                    //getBoundingClientRect
                    var imgWei = this.$refs.img.getBoundingClientRect();
                    // ç§»åŠ¨å›¾ç­¾çš„èµ·å§‹åæ ‡è·å–
                    var gouWei = document.getElementById("gouwu").getBoundingClientRect();
                    // ç§»åŠ¨å›¾æ ‡ç§»åŠ¨ä½ç½®ç»ˆç‚¹åæ ‡
                    //var gouHei = document.getElementById("gou").offsetHeight;
                    var x = gouWei.left-imgWei.left;
                    var y = gouWei.top-imgWei.top;
                    //ä¸¤ä½ç½®çš„è·ç¦»
                    //å­—ç¬¦ä¸²æ¨¡æ¿
                    el.style.transform = `translate( ${x}px,${y}px ) scale(0.3)`;
                    el.style.transition = 'all 1s cubic-bezier(0,0,1,1)';
                    
                    // è¿™é‡Œçš„ doneï¼Œå…¶å®å°±æ˜¯ afterEnter è¿™ä¸ªå‡½æ•°ï¼Œ
                    // ä¹Ÿå°±æ˜¯è¯´ï¼šdone æ˜¯ afterEnter å‡½æ•°çš„å¼•ç”¨
                    done();
                },
        afterEnter(el) {
                    //è¡¨ç¤ºåŠ¨ç”»å®Œæˆä¹‹åå°çƒçš„çŠ¶æ€

				    // ä½¿ç”¨ flag æ ‡è¯†ç¬¦ï¼Œæ¥è¡¨ç¤ºåŠ¨ç”»çš„åˆ‡æ¢ï¼›
				    // Vue æŠŠä¸€ä¸ªå®Œæ•´çš„åŠ¨ç”»ï¼Œä½¿ç”¨é’©å­å‡½æ•°ï¼Œæ‹†åˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†ï¼›
				    // å¯¹flagï¼šç¬¬ä¸€éƒ¨åˆ† false -> true ;  ç¬¬äºŒéƒ¨åˆ† true -> false
				    
				    // è¿™å¥è¯ï¼Œç¬¬ä¸€ä¸ªåŠŸèƒ½ï¼Œæ˜¯æ§åˆ¶å°çƒçš„æ˜¾ç¤ºä¸éšè—
				    // ç¬¬äºŒä¸ªåŠŸèƒ½ï¼šç›´æ¥è·³è¿‡ååŠåœºåŠ¨ç”»ï¼Œè®© flag æ ‡è¯†ç¬¦ç›´æ¥å˜ä¸º false
				    // å½“ç¬¬äºŒæ¬¡å†ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ï¼Œflag = false -> true
                    this.flag = !this.flag;
                    clearTimeout(this.addItems)
                    let shopinfo = {
                        id:this.id,
                        number:this.goodsNumber,
                        price:this.sell_price,
                        seleted:true
                    }
                    this.$store.commit('addChar',shopinfo);
                    console.log(this.$store.getters.getGoodsCount);
                },
                    addItems(){        //å»¶è¿Ÿæ‰§è¡Œ
                        setTimeout(()=>{
                            this.$store.commit('add')
                        },1000)
                    
                    }

    },
    created(){
        //this.getGoodImage();
        this.getGoodsInfo();
    },
    components: {
         'swiper':swiper,
    },
    

}
</script>

<style scoped>
    .items{
        background: red;
        color: #fff;
    }
    .ball{
        width: 50px;
        height: 50px;
        position: fixed;
        right: 20px;
        z-index: 999;
    }
    .mui-popover{
        left: 0px;
    }
    #item2 .mui-card:nth-child(1){
        margin-top: 70px;
    }
    .mui-action-back{
        touch-action: none;
    }
    #item1 .mui-card{
        margin-top: 70px;
        margin-bottom: 70px;
    }
    .mui-segmented-control{
        border: none;
        touch-action: none;
    }
    .mui-segmented-control .mui-control-item{
        border-left: none;
    }
    .mui-bar{
        height: 50px;
        padding: 0px;
    }
    .mui-bar-nav.mui-bar .mui-icon{
        line-height: 50px;
        margin-left: 5px;
        margin-right: 5px;
    }
    .mui-card-header > img:first-child{
        width: 100%;
        height: 100%;
    }
    .price span:nth-child(1){
        color: #999;
        text-decoration: line-through;
    }
    .price span:nth-child(2){
        color: red;
        font-weight:900; 
        font-size: 18px;
    }
    .xiang{
        width: 100%;
    }
    .xiang span{
        color:#000;
    }
    .righ{
        float: right;
        font-weight: bolder;
    }
    .mui-card-footer img{
        width: 80px;
        height: 80px;
    }
    .star{
        color: yellow;
    }
    .xi{
        width: 100%;
        height: 100%;
        margin-top: 30px;
    }
    .buy{
        position: fixed;
        bottom: 0px;
        z-index: 20;
    }
    .buy a{
        display: inline-block;
        color: #000;
        text-align: center;
        margin: 5px 0px;
    }
    .buy a:nth-child(1) div{
        font-size: 14px;
    }
    .mui-bar .mui-icon{
        padding: 0px;
    }
    .buy a:nth-child(4){
        background: orange;
        color: #fff;
        line-height: 58px;
        position: absolute;
        margin: 0px;
    }
    .buy a:nth-child(5){
        background: red;
        color: #fff;
        line-height: 58px;
        position: absolute;
        right: 0px;
        margin: 0px;
    }
    .mui-pull-left{
        margin-top: 10px;
    }
    .mui-table-view.mui-grid-view{
        margin-top: 70px;
    }
</style>
